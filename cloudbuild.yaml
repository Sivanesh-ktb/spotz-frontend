timeout: '1200s'

steps:
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:slim'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "Authenticating with GCP..."
        echo "${_GCP_CREDENTIALS}" > /root/gcp-key.json
        gcloud auth activate-service-account --key-file=/root/gcp-key.json
        gcloud config set project ${_PROJECT_ID}

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk:slim'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "Deploying to private Compute Engine instance..."
        gcloud compute ssh ubuntu@${_INSTANCE_NAME} --zone=${_ZONE} --command="
          cd /opt/nodejs/spotz-frontend &&
          git pull &&
          cp /opt/nodejs/config/environment.demo /opt/nodejs/spotz-frontend/src/environments/environment.ts &&
          npm install &&
          npm run build
        "

substitutions:
  _INSTANCE_NAME: "test"
  _ZONE: "us-central1-c"
  _PROJECT_ID: "lyrical-beach-439615-f1"
  _GCP_CREDENTIALS: |
    {
      "type": "service_account",
      "project_id": "lyrical-beach-439615-f1",
      "private_key_id": "555fe4ec6569e9c88fb73db1c5f548fac1aa6301",
      "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC2srk2NHlWjuQh\numTigH+6rcfSb69PVIXCuuu773+nFYcHGlF09TJJcRPPPD8jm0RjgzX8Dt7uT2qR\nuc+597u7YpHeMwXYeGqx//opDmF12oY4oVsIG7y5Yl3c7tx324BSedwWQDVmk+Jy\nHmvtNUoSV4yGiIMez4BAdBPKh0LHXrM+jbON/0gMyqPy5/PYLmTi7u/VamZWpvaI\n4FwmqdJ67RXtu6o6Vwch1XZgGzgamq3Z7+7QQegvTatyNgNHkcGkog8Rk9/4CYnt\nv2QXMADcqDocJvOi1ChKwuF+/ngguO9HsVJF2qAqLSjoJFnXiNFkyK+B+9HkDOww\n6dUDLwdRAgMBAAECggEAB3K0TcMoYjC7mKtoYvqBmorsn0XZ1AZaWKS1qQj7v4RH\nZ7D5OqcnWGqhd9yZJ1q0WEk4WXECwhzfN5cnYom4r8w2LaSPW7KXCPAqUuOo8fzJ\nZYQgea1lzXn24SOkvccnTVV19TtDYg3r2KKoXDiEr0g97Jsim04yyI3i46oNfSKr\nze7olrCIeoRYagRrIVCFGWB2kyQ7+zZ+FpzjjRT9ZKl7/iDmqT5jfrCF9hhApnAA\nLqFVYtGRqrSi6uaBriSjekDNlIcMypBbhvS/bkVZX8bitp0459uAKDUmOPzKBEfQ\nL58cc+QOX8HGkba11BgAs4G1a0AWl1i0m1IutgHEBQKBgQDiGfLFN3oR5JuxOQaR\n6LY34fa/txfQPKg3pz88iLnBK+DEJWJOYTkpBeoqMDSLQxMiwDBLS1AK5+v8VU6w\nuVJ6TNJbHXYyDgUiwlh5cT4/dIb5k/I0PO2m3Ox4kN5d1yuQ8VhOvgTIl2NUwei/\n7H6vQvGIkBvOBw7aMva8vQMp1QKBgQDO23nlWH809FbQlJNZYqbGdxUU31EpSDSd\nMQQossxOYLbV52dwrK02Ij3IKdgWY/WT/8GygAnYFBD4Vnkf8yLhmGnLD9GR4GvU\nQGI1XCmB3ibn/zGDDKfQ0Vak5hNby7ZhrFbZzU1TK/ZH2Y1adTlwV5pEb8EhEeEQ\n6VhYw9aJjQKBgB69RGJHrpLsL7aieCAyMUPbtr5N2DD5bi1S0agbNpXqrz47juf1\nE95d7X4a26nrTpi05Fv4O0OgUFcYCgDA0VPLSfYVRVJ80XnuTjUEjl/2KbuYv58W\ngYDkHEov9+tuK4AjL8xUzTWwT1LgohIlxvtw8IGOhhk2oHBN6XmzgNCZAoGAev5G\niRZIdHz/jX956UDd9s1hTIrHoCsdlYVKesRs9AFPVPoFKBqT1scfQv+WSyHeJ8R/\nMBovQDoWKQKJfHS9fbN429MpAXqVwpsRibalu2EScwjqMIh6049U3DEsu3zxkTu+\nXDxUyKowAmKZSHrAz0pXIG/uPjJ6Rurnq8etrRUCgYBoNTbppO34s2okqvpnHbTL\noNr140ciQrs+gf3S3ntfebLn0euub4vvKHqzlEZlypmtlFcYUf6WqytdwvA6C7qB\nVX6j5OEFivT1xFv0SAI1j2ZxOjIVFJJ9Mw5g6bD3XmbajQ+rZznWVPA3vZcZsZso\nsG3bN4t9AAZbYatw74I5Hg==\n-----END PRIVATE KEY-----\n"
      
options:
  logging: GCS_ONLY  # Logs will only be available in Google Cloud Storage, not shown in the console
